<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¹ ì¸í„°ë™í‹°ë¸Œ í”¼ì•„ë…¸ ê±´ë°˜</title>
    <!-- Tailwind CSS CDN ë¡œë“œ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ì„¤ì • -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì„¤ì • ë° Inter í°íŠ¸ ì ìš© */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: auto; /* ì‘ì€ í™”ë©´ì—ì„œ ìŠ¤í¬ë¡¤ í—ˆìš© */
        }
        
        /* í”¼ì•„ë…¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
        #piano-container {
            padding: 20px;
            background: #1f2937; /* ë‹¤í¬ ê·¸ë ˆì´ ë°°ê²½ */
            border-radius: 1.5rem; /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            max-width: 100%;
            overflow-x: auto; /* ê±´ë°˜ì´ ë„˜ì¹  ê²½ìš° ê°€ë¡œ ìŠ¤í¬ë¡¤ */
            position: relative;
        }

        /* ê±´ë°˜ ì˜ì—­ (í™”ì´íŠ¸ í‚¤ì™€ ë¸”ë™ í‚¤ë¥¼ í¬í•¨) */
        #keyboard {
            display: flex;
            position: relative;
            user-select: none;
            width: fit-content; /* ë‚´ìš©ë¬¼ ë„ˆë¹„ì— ë§ì¶¤ */
            min-width: 700px;
        }

        /* í™”ì´íŠ¸ í‚¤ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .key {
            width: 80px;
            height: 300px;
            border: 1px solid #1f2937;
            border-radius: 0 0 10px 10px;
            background-color: #ffffff;
            position: relative;
            margin-right: -1px; /* í‚¤ ê°„ì˜ ê²½ê³„ë¥¼ ìµœì†Œí™” */
            transition: background-color 0.05s ease, transform 0.05s ease;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 10px;
            box-shadow: 0 5px 0 #bbb; /* ëˆŒë¦¬ì§€ ì•Šì€ ìƒíƒœì˜ ê·¸ë¦¼ì */
            z-index: 1;
        }
        
        /* í™”ì´íŠ¸ í‚¤ê°€ ëˆŒë ¸ì„ ë•Œ (ë§ˆìš°ìŠ¤/í„°ì¹˜) */
        .key:active, .key.active {
            background-color: #ccc;
            transform: translateY(3px);
            box-shadow: 0 2px 0 #888;
        }

        /* ë¸”ë™ í‚¤ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .black-key {
            width: 45px;
            height: 180px;
            background-color: #000000;
            position: absolute;
            z-index: 2;
            margin-left: -22.5px;
            border-radius: 0 0 8px 8px;
            transition: background-color 0.05s ease, transform 0.05s ease;
            cursor: pointer;
            box-shadow: 0 5px 0 #333;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 5px;
            color: #ffffff;
            font-size: 0.9rem;
        }

        /* ë¸”ë™ í‚¤ê°€ ëˆŒë ¸ì„ ë•Œ (ë§ˆìš°ìŠ¤/í„°ì¹˜) */
        .black-key:active, .black-key.active {
            background-color: #333;
            transform: translateY(3px);
            box-shadow: 0 2px 0 #000;
        }

        /* í‚¤ë³´ë“œ ë¬¸ì í‘œì‹œ ìŠ¤íƒ€ì¼ */
        .key-label {
            position: absolute;
            bottom: 5px;
            font-size: 0.8rem;
            color: #333;
            font-weight: bold;
        }

        .black-key .key-label {
            color: #ccc;
        }
    </style>
</head>
<body>

<div class="p-8 md:p-12">
    <h1 class="text-3xl md:text-4xl font-bold text-center mb-4 text-gray-800">
        ğŸ¹ ì›¹ ì¸í„°ë™í‹°ë¸Œ í”¼ì•„ë…¸
    </h1>
    <p class="text-center text-gray-600 mb-8 max-w-xl mx-auto">
        ë§ˆìš°ìŠ¤ í´ë¦­, í„°ì¹˜ ë˜ëŠ” í‚¤ë³´ë“œ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—°ì£¼í•´ ë³´ì„¸ìš”.
    </p>

    <div id="piano-container">
        <div id="keyboard">
            <!-- JavaScriptê°€ ì—¬ê¸°ì— ê±´ë°˜ì„ ìƒì„±í•©ë‹ˆë‹¤. -->
        </div>
    </div>

    <div id="instructions" class="mt-8 p-4 bg-white rounded-xl shadow-lg max-w-3xl mx-auto">
        <h2 class="text-xl font-semibold mb-3 text-gray-700">í‚¤ë³´ë“œ ì—°ì£¼ ê°€ì´ë“œ</h2>
        <p class="text-gray-600">ì»´í“¨í„° í‚¤ë³´ë“œì˜ ë‹¤ìŒ í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—°ì£¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        <div class="mt-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="bg-gray-100 p-3 rounded-lg">
                <p class="font-bold text-gray-800">í™”ì´íŠ¸ í‚¤ (ì˜¨ìŒ):</p>
                <code class="text-blue-600 font-mono">A S D F G H J K</code>
                <span class="text-sm text-gray-500 block">(C4 D4 E4 F4 G4 A4 B4 C5)</span>
            </div>
            <div class="bg-gray-100 p-3 rounded-lg">
                <p class="font-bold text-gray-800">ë¸”ë™ í‚¤ (ë°˜ìŒ):</p>
                <code class="text-red-600 font-mono">W E T Y U</code>
                <span class="text-sm text-gray-500 block">(C#4 D#4 F#4 G#4 A#4)</span>
            </div>
        </div>
        <p class="text-xs text-gray-500 mt-4">Tip: í‚¤ë³´ë“œì—ì„œ ì†ì„ ë–¼ë©´ ì†Œë¦¬ê°€ ë©ˆì¶¥ë‹ˆë‹¤.</p>
    </div>
</div>

<script>
    // Web Audio APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì†Œë¦¬ë¥¼ ì¬ìƒí•˜ëŠ” ë¡œì§
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    let audioContext;
    
    // í˜„ì¬ í™œì„±í™”ëœ ì˜¤ì‹¤ë ˆì´í„° (í‚¤ë¥¼ ëˆ„ë¥´ê³  ìˆì„ ë•Œ ì†Œë¦¬ ìœ ì§€)
    const activeOscillators = {}; 

    // ê±´ë°˜ì˜ ë…¸íŠ¸ì™€ ì£¼íŒŒìˆ˜(Hz), ê·¸ë¦¬ê³  í‚¤ë³´ë“œ ë§¤í•‘ ì •ë³´
    const notes = [
        // 4ì˜¥íƒ€ë¸Œ
        { note: 'C4', frequency: 261.63, key: 'A', isBlack: false },
        { note: 'C#4', frequency: 277.18, key: 'W', isBlack: true },
        { note: 'D4', frequency: 293.66, key: 'S', isBlack: false },
        { note: 'D#4', frequency: 311.13, key: 'E', isBlack: true },
        { note: 'E4', frequency: 329.63, key: 'D', isBlack: false },
        { note: 'F4', frequency: 349.23, key: 'F', isBlack: false },
        { note: 'F#4', frequency: 369.99, key: 'T', isBlack: true },
        { note: 'G4', frequency: 392.00, key: 'G', isBlack: false },
        { note: 'G#4', frequency: 415.30, key: 'Y', isBlack: true },
        { note: 'A4', frequency: 440.00, key: 'H', isBlack: false },
        { note: 'A#4', frequency: 466.16, key: 'U', isBlack: true },
        { note: 'B4', frequency: 493.88, key: 'J', isBlack: false },
        // 5ì˜¥íƒ€ë¸Œ ì‹œì‘
        { note: 'C5', frequency: 523.25, key: 'K', isBlack: false }
    ];

    /**
     * íŠ¹ì • ì£¼íŒŒìˆ˜ì˜ ìŒì„ ì¬ìƒí•©ë‹ˆë‹¤.
     * @param {number} frequency - ì¬ìƒí•  ìŒì˜ ì£¼íŒŒìˆ˜ (Hz).
     * @param {string} noteName - ìŒí‘œ ì´ë¦„ (ì˜ˆ: 'C4').
     */
    function playNote(frequency, noteName) {
        // AudioContextê°€ ì—†ìœ¼ë©´ ì´ˆê¸°í™”
        if (!audioContext) {
            audioContext = new AudioContext();
        }

        // ì´ë¯¸ ì¬ìƒ ì¤‘ì¸ ê²½ìš° ë¬´ì‹œ (í‚¤ë³´ë“œ ì—°íƒ€ ë°©ì§€)
        if (activeOscillators[noteName]) {
            return;
        }

        // 1. ì˜¤ì‹¤ë ˆì´í„°(ì†Œë¦¬ ìƒì„±ê¸°) ìƒì„±
        const oscillator = audioContext.createOscillator();
        oscillator.type = 'sine'; // ì‚¬ì¸íŒŒ (ê°€ì¥ ê¸°ë³¸ì ì¸ íŒŒí˜•)
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);

        // 2. ê²Œì¸ ë…¸ë“œ(ë³¼ë¥¨ ì¡°ì ˆê¸°) ìƒì„± ë° ë³¼ë¥¨ ì„¤ì •
        const gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        // ë¶€ë“œëŸ¬ìš´ ì‹œì‘(ì–´íƒ)
        gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.01);
        
        // 3. ë…¸ë“œ ì—°ê²°: ì˜¤ì‹¤ë ˆì´í„° -> ê²Œì¸ ë…¸ë“œ -> ì¶œë ¥
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        // 4. ì†Œë¦¬ ì¬ìƒ ì‹œì‘
        oscillator.start();
        
        // 5. í™œì„± ì˜¤ì‹¤ë ˆì´í„° ë§µì— ì €ì¥
        activeOscillators[noteName] = { oscillator, gainNode };
    }

    /**
     * ìŒ ì¬ìƒì„ ë©ˆì¶¥ë‹ˆë‹¤.
     * @param {string} noteName - ë©ˆì¶œ ìŒí‘œ ì´ë¦„ (ì˜ˆ: 'C4').
     */
    function stopNote(noteName) {
        const activeNote = activeOscillators[noteName];
        if (!activeNote) return;

        const { oscillator, gainNode } = activeNote;

        // ë¶€ë“œëŸ¬ìš´ ë©ˆì¶¤(ë¦´ë¦¬ì¦ˆ)
        gainNode.gain.cancelScheduledValues(audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.2); // 0.2ì´ˆì— ê±¸ì³ ë³¼ë¥¨ì„ 0ìœ¼ë¡œ ê°ì†Œ
        
        // ì†Œë¦¬ê°€ ì™„ì „íˆ ì‚¬ë¼ì§„ í›„ ì˜¤ì‹¤ë ˆì´í„°ë¥¼ ë©ˆì¶¤
        oscillator.stop(audioContext.currentTime + 0.2); 

        // ë§µì—ì„œ ì œê±°
        delete activeOscillators[noteName];
    }
    
    /**
     * DOMì— í”¼ì•„ë…¸ ê±´ë°˜ ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
     */
    function initializePiano() {
        const keyboardDiv = document.getElementById('keyboard');
        const whiteKeyIndexMap = {}; // í™”ì´íŠ¸ í‚¤ ì¸ë±ìŠ¤ ì¶”ì  (ë¸”ë™ í‚¤ ë°°ì¹˜ë¥¼ ìœ„í•¨)
        let whiteKeyCount = 0;

        notes.forEach((noteData, index) => {
            const keyElement = document.createElement('div');
            const noteName = noteData.note;
            
            keyElement.dataset.note = noteName;
            keyElement.id = `key-${noteName}`;

            // í™”ì´íŠ¸ í‚¤ ìƒì„±
            if (!noteData.isBlack) {
                keyElement.classList.add('key');
                whiteKeyIndexMap[noteName] = whiteKeyCount++;
                
                // í‚¤ë³´ë“œ ë ˆì´ë¸” ì¶”ê°€
                keyElement.innerHTML = `<span class="key-label">${noteData.key}<br/>${noteName}</span>`;
                keyboardDiv.appendChild(keyElement);
                
                // ë¸”ë™ í‚¤ ë°°ì¹˜ ìœ„ì¹˜ ê³„ì‚° (C, D, F, G, A ë‹¤ìŒì— ë¸”ë™ í‚¤ê°€ ìœ„ì¹˜)
                const isBlackKeyFollowed = ['C4', 'D4', 'F4', 'G4', 'A4'].includes(noteName);
                if (isBlackKeyFollowed) {
                    // ë‹¤ìŒ ìŒí‘œê°€ ë¸”ë™ í‚¤ë¼ë©´
                    const nextNoteData = notes[index + 1];
                    if (nextNoteData && nextNoteData.isBlack) {
                        const blackKeyElement = createBlackKey(nextNoteData);
                        // í™”ì´íŠ¸ í‚¤ì˜ ì ˆë°˜ ë„ˆë¹„ë§Œí¼ ì™¼ìª½ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë‘ í‚¤ ì‚¬ì´ì— ë°°ì¹˜
                        blackKeyElement.style.left = `${(whiteKeyCount - 1) * 80 + 80 - (45 / 2)}px`; 
                        keyboardDiv.appendChild(blackKeyElement);
                    }
                }

            }
        });

        // ë¸”ë™ í‚¤ ìš”ì†Œë¥¼ ìƒì„±í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
        function createBlackKey(noteData) {
            const blackKeyElement = document.createElement('div');
            blackKeyElement.classList.add('black-key');
            blackKeyElement.dataset.note = noteData.note;
            blackKeyElement.id = `key-${noteData.note}`;
            // í‚¤ë³´ë“œ ë ˆì´ë¸” ì¶”ê°€
            blackKeyElement.innerHTML = `<span class="key-label">${noteData.key}<br/>${noteData.note}</span>`;
            
            return blackKeyElement;
        }

        // ì „ì²´ ê±´ë°˜ì— ë§ˆìš°ìŠ¤/í„°ì¹˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
        const allKeys = document.querySelectorAll('.key, .black-key');
        allKeys.forEach(key => {
            // ë§ˆìš°ìŠ¤ ë‹¤ìš´/í„°ì¹˜ ì‹œì‘
            key.addEventListener('mousedown', (e) => startPlay(e, key.dataset.note));
            key.addEventListener('touchstart', (e) => startPlay(e, key.dataset.note));
            // ë§ˆìš°ìŠ¤ ì—…/í„°ì¹˜ ë
            key.addEventListener('mouseup', (e) => endPlay(e, key.dataset.note));
            key.addEventListener('touchend', (e) => endPlay(e, key.dataset.note));
            key.addEventListener('mouseleave', (e) => {
                // ë§ˆìš°ìŠ¤ë¥¼ í‚¤ ë°–ìœ¼ë¡œ ì´ë™í–ˆì„ ë•Œ ì¬ìƒ ì¤‘ì´ë©´ ë©ˆì¶¤ (mouseup ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
                if (e.buttons === 1) { // ë§ˆìš°ìŠ¤ ì™¼ìª½ ë²„íŠ¼ì´ ëˆŒë¦° ìƒíƒœì¸ì§€ í™•ì¸
                    endPlay(e, key.dataset.note);
                }
            });
        });

        // ì´ë²¤íŠ¸ ì‹œì‘ ë° ì¤‘ì§€ í—¬í¼ í•¨ìˆ˜
        function startPlay(e, noteName) {
            e.preventDefault(); // í„°ì¹˜ ì´ë²¤íŠ¸ì—ì„œ ê¸°ë³¸ ë™ì‘(ìŠ¤í¬ë¡¤ ë“±) ë°©ì§€
            const keyElement = document.getElementById(`key-${noteName}`);
            const noteData = notes.find(n => n.note === noteName);
            
            if (noteData) {
                playNote(noteData.frequency, noteName);
                keyElement.classList.add('active'); // ì‹œê°ì  í™œì„±í™”
            }
        }

        function endPlay(e, noteName) {
            e.preventDefault();
            const keyElement = document.getElementById(`key-${noteName}`);
            stopNote(noteName);
            keyElement.classList.remove('active'); // ì‹œê°ì  ë¹„í™œì„±í™”
        }


        // ==========================================================
        // í‚¤ë³´ë“œ ì…ë ¥ ë§¤í•‘
        // ==========================================================
        const keyMap = {};
        notes.forEach(noteData => {
            if (noteData.key) {
                keyMap[noteData.key.toLowerCase()] = noteData;
            }
        });

        let pressedKeys = {}; // í˜„ì¬ ëˆŒë¦° í‚¤ë³´ë“œ í‚¤ ì¶”ì 

        document.addEventListener('keydown', (e) => {
            const key = e.key.toUpperCase();
            const noteData = keyMap[key];

            if (noteData && !pressedKeys[key]) {
                e.preventDefault(); // ì›¹í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë“± ê¸°ë³¸ ë™ì‘ ë°©ì§€
                
                // ìŒ ì¬ìƒ
                playNote(noteData.frequency, noteData.note);
                pressedKeys[key] = true;

                // ì‹œê°ì  í™œì„±í™”
                const keyElement = document.getElementById(`key-${noteData.note}`);
                if (keyElement) {
                    keyElement.classList.add('active');
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            const key = e.key.toUpperCase();
            const noteData = keyMap[key];

            if (noteData && pressedKeys[key]) {
                e.preventDefault();
                
                // ìŒ ì¤‘ì§€
                stopNote(noteData.note);
                delete pressedKeys[key];

                // ì‹œê°ì  ë¹„í™œì„±í™”
                const keyElement = document.getElementById(`key-${noteData.note}`);
                if (keyElement) {
                    keyElement.classList.remove('active');
                }
            }
        });

    }

    // í˜ì´ì§€ ë¡œë“œ í›„ í”¼ì•„ë…¸ ì´ˆê¸°í™”
    window.onload = initializePiano;
</script>

</body>
</html>
